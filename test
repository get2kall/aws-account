import pymysql.cursors
import sys
import os

def insert_data(registry, image, version, scan_tool, status):
    host = os.environ['RDS_HOST']
    user = os.environ['RDS_USER']
    password = os.environ['RDS_PASSWORD']
    database = os.environ['RDS_DATABASE']

    connection = pymysql.connect(
        host=host,
        user=user,
        password=password,
        database=database,
        cursorclass=pymysql.cursors.DictCursor
    )

    try:
        with connection.cursor() as cursor:
            sql = "INSERT INTO result_data (registry, image, version, scan_tool, timestamp, status) VALUES (%s, %s, %s, %s, NOW(), %s)"
            cursor.execute(sql, (registry, image, version, scan_tool, status))
        connection.commit()
    finally:
        connection.close()

if __name__ == "__main__":
    registry = sys.argv[1]
    image = sys.argv[2]
    version = sys.argv[3]
    scan_tool = sys.argv[4]
    status = sys.argv[5]
    insert_data(registry, image, version, scan_tool, status)
