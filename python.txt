#!/bin/bash

# Output file
output_file="snyk_scan_results.csv"

# Write the header to the output file
echo "Image,Vulnerability" > $output_file

# Read the CSV file line by line
while IFS=, read -r image
do
    # Run the Snyk scan command on each image
    output=$(snyk container test $image)

    # Parse the Snyk output to check for vulnerabilities
    if echo $output | grep -q "No known vulnerabilities"; then
        echo "$image,No vulnerability" >> $output_file
    else
        echo "$image,Vulnerability" >> $output_file
    fi
done < images.csv
