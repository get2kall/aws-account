import json

# Read the contents of images.txt
with open('images.txt', 'r') as file:
    content = file.read().strip()

# Process the content and create the matrix JSON data
lines = content.split('\n')
image_list = []
for line in lines:
    # Remove leading/trailing whitespace from each line
    line = line.strip()

    # Handle different image name formats
    if ':' in line:
        # If the line contains a colon, assume it's in the format "registry/image:tag"
        parts = line.split(':')
        if len(parts) == 3:
            # If the line has three parts, consider the first part as the registry, second as the image, and third as the version
            registry = parts[0]
            image = parts[1]
            version = parts[2]
        elif len(parts) == 2:
            # If the line has two parts, consider the first part as the image and the second as the version
            registry = ''
            image = parts[0]
            version = parts[1]
        else:
            print(f"Invalid format in line: {line}")
            continue
    else:
        # If the line does not contain a colon, assume it's just the image name with no specified version or registry
        registry = ''
        image = line
        version = ''

    image_list.append({
        'registry': registry,
        'image': image,
        'version': version
    })

matrix_data = {
    'include': image_list
}
matrix_output = json.dumps(matrix_data)

# Output the matrix data to stdout
print(matrix_output)
